<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cib.cap4j.cfn.codeInfo.dao.IPCodeInfoDao">
	<resultMap id="ipCodeInfo_resultMap" type="com.cib.cap4j.cfn.codeInfo.vo.IPCodeInfoVO">
		<id property="zj" column="ZJ"/>
		<result property="mblxbh" column="MBLXBH"/>
		<result property="mbtmz" column="MBTMZ"/>
		<result property="sjlx" column="SJLX"/>
		<result property="mbtmms" column="MBTMMS"/>
		<result property="sjsxsy" column="SJSXSY"/>
		<result property="gjdbm" column="GJDBM"/>
		<result property="fjdbm" column="FJDBM"/>
		<result property="bmjb" column="BMJB"/>
		<result property="qlj" column="QLJ"/>
		<result property="sfkj" column="SFKJ"/>
		<result property="sjsygjhxx" column="SJSYGJHXX"/>
		<result property="jlzt" column="JLZT"/>
		<result property="kzzd" column="KZZD"/>
		
    </resultMap>
    
    <!-- 根据码表类型编码获取所有的码表 -->
    <select id="selectInfosByTypeId" parameterType="java.lang.String" resultMap="ipCodeInfo_resultMap">
    	SELECT ZJ,MBLXBH,MBTMZ,SJLX,MBTMMS,SJSXSY,GJDBM,FJDBM,BMJB,QLJ,SFKJ,SJSYGJHXX,JLZT,KZZD
        FROM IP_CODEINFO 
        WHERE SJLX = #{sjlx} and JLZT = 1
    </select>
    
    <!-- 新增码表条目信息 -->
    <insert id="saveInfo" parameterType="com.cib.cap4j.cfn.codeInfo.vo.IPCodeInfoVO">
    	INSERT INTO IP_CODEINFO(ZJ,MBLXBH,MBTMZ,SJLX,MBTMMS,SJSXSY,GJDBM,FJDBM,BMJB,QLJ,SFKJ,SJSYGJHXX,JLZT,KZZD)
    	VALUES(
	    	#{zj,jdbcType=VARCHAR},#{mblxbh,jdbcType=VARCHAR},#{mbtmz,jdbcType=VARCHAR},
	    	#{sjlx,jdbcType=VARCHAR},#{mbtmms,jdbcType=VARCHAR},#{sjsxsy,jdbcType=FLOAT},#{gjdbm,jdbcType=VARCHAR},
	    	#{fjdbm,jdbcType=VARCHAR},#{bmjb,jdbcType=INTEGER},#{qlj,jdbcType=VARCHAR},
	    	#{sfkj,jdbcType=VARCHAR},#{sjsygjhxx,jdbcType=VARCHAR},#{jlzt,jdbcType=VARCHAR},
	    	#{kzzd,jdbcType=VARCHAR}
    	)
    </insert>
    
    <!-- 正常的删除动作 -->
	<!-- 
	<delete id="deleteInfo" parameterType="com.cib.cap4j.cfn.codeInfo.vo.IPCodeInfoVO">
		DELETE FROM IP_CODEINFO WHERE ZJ = #{zj}
	</delete>
	 -->
    
    <!-- 码表的删除功能 -->
	<update id="deleteInfo" parameterType="com.cib.cap4j.cfn.codeInfo.vo.IPCodeInfoVO">
		UPDATE IP_CODEINFO
     	<set>
     		JLZT = #{jlzt}
     	</set>
     	WHERE ZJ = #{zj}
	</update>
	
	<!-- 根据码表类型id对码表的删除-->
	<update id="deleteInfoByTypeId" parameterType="java.lang.String">
		UPDATE IP_CODEINFO
     	<set>
     		JLZT = 0
     	</set>
     	WHERE SJLX = #{_parameter}
	</update>
	
	<!-- 码表条目更新功能 -->
	<update id="updateInfo" parameterType="com.cib.cap4j.cfn.codeInfo.vo.IPCodeInfoVO">
     	UPDATE IP_CODEINFO
     	<set>
     		<if test="mblxbh != null">MBLXBH = #{mblxbh},</if>
     		<if test="mbtmz != null">MBTMZ = #{mbtmz},</if>
     		<if test="sjlx != null">SJLX = #{sjlx},</if>
	    	<if test="mbtmms != null">MBTMMS = #{mbtmms},</if>
	    	<if test="sjsxsy != null">SJSXSY = #{sjsxsy},</if>
	    	<if test="gjdbm != null">GJDBM = #{gjdbm},</if>
	    	<if test="fjdbm != null">FJDBM = #{fjdbm}, </if>
	    	<if test="bmjb != null">BMJB = #{bmjb},</if>
	    	<if test="qlj != null">QLJ = #{qlj},</if>
	    	<if test="sfkj != null">SFKJ = #{sfkj}, </if>
	    	<if test="sjsygjhxx != null">SJSYGJHXX = #{sjsygjhxx},</if>
	    	<if test="jlzt != null">JLZT = #{jlzt},</if>
	    	<if test="kzzd != null">KZZD = #{kzzd}</if>
     	</set>
     	WHERE ZJ = #{zj}
    </update>
    
    <!-- 根据主键获取对应的码表条目信息 -->
    <select id="findIPCodeInfoByKey" resultMap="ipCodeInfo_resultMap" parameterType="java.lang.String">
    	SELECT ZJ,MBLXBH,MBTMZ,SJLX,MBTMMS,SJSXSY,GJDBM,FJDBM,BMJB,QLJ,SFKJ,SJSYGJHXX,JLZT,KZZD
        	FROM IP_CODEINFO 
        WHERE JLZT = 1
        <if test="_parameter != null">  AND ZJ = #{_parameter}</if>
    </select>
    
    <!-- 根据父节点编码获取所有子节点 -->
    <select id="findChildrenInfosByFjdbm" resultMap="ipCodeInfo_resultMap">
    	SELECT ZJ,MBLXBH,MBTMZ,SJLX,MBTMMS,SJSXSY,GJDBM,FJDBM,BMJB,QLJ,SFKJ,SJSYGJHXX,JLZT,KZZD
        	FROM IP_CODEINFO 
        WHERE JLZT = 1
        <if test="fjdbm != null">  AND FJDBM = #{fjdbm}</if>
    </select>
    
    <!-- 获取分页信息 -->
    <select id="findAllInfosByTypeIdAndInfoCode" resultMap="ipCodeInfo_resultMap">
    	SELECT ZJ,MBLXBH,MBTMZ,SJLX,MBTMMS,SJSXSY,GJDBM,FJDBM,BMJB,QLJ,SFKJ,SJSYGJHXX,JLZT,KZZD
        	FROM IP_CODEINFO 
        WHERE JLZT = 1
        <if test="sjlx != null">  AND SJLX  like ${sjlx}</if>
        <if test="mblxbh != null">  AND MBLXBH  like ${mblxbh}</if>
    </select>
    
    <!-- 获取对应条件的总条数 -->
    <select id="findAllInfosByTypeIdAndInfoCodeCount" resultType="java.lang.Integer">
    	SELECT COUNT(*)
        	FROM IP_CODEINFO 
        WHERE JLZT = 1
        <if test="sjlx != null">  AND SJLX  like ${sjlx}</if>
        <if test="mblxbh != null">  AND MBLXBH  like ${mblxbh}</if>
    </select>
    
    <!-- 业务特有，模板不用提取 -->
    <!-- 根据码表类型编码获取所有对应的条目列表 -->
    <select id="findAllInfosByTypeCode" resultMap="ipCodeInfo_resultMap">
    	SELECT F.ZJ,F.MBLXBH,F.MBTMZ,F.SJLX,F.MBTMMS,F.SJSXSY,F.GJDBM,F.FJDBM,
    			F.BMJB,F.QLJ,F.SFKJ,F.SJSYGJHXX,F.JLZT,F.KZZD
        	FROM IP_CODEINFO F INNER JOIN IP_CODETYPE T ON F.SJLX = T.ZJ
        WHERE F.JLZT = 1 AND T.JLZT = 1
        <if test="sjlxbh != null">  AND T.SJLXBH = #{sjlxbh}</if>
    </select>
    
</mapper>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cib.cap4j.cfn.dataManage.dao.IIpMetadataPermissionDao">
		<resultMap id="ipMetadataPermission_result" type="com.cib.cap4j.cfn.dataManage.vo.IpMetadataPermissionVO">
		     <id column="ZDQXZJ" property="zdqxzj" />
		     <result column="SJBSJQXBH" property="sjbsjqxbh" />
		     <result column="ZDBM" property="zdbm" />
		     <result column="SFKYXG" property="sfkyxg" />
		     <result column="SFKYXS" property="sfkyxs" />
		</resultMap>
		<select id = "getMetadataPer" resultMap="ipMetadataPermission_result" parameterType="java.util.HashMap">
			SELECT * FROM IP_METADATA_PERMISSION WHERE 1=1 
			<if test="sjbsjqxbh != null">  AND sjbsjqxbh = #{sjbsjqxbh}</if>
			 
		</select>
		<insert id = "saveMetaDataPer" parameterType="com.cib.cap4j.cfn.dataManage.vo.IpMetadataPermissionVO">
			INSERT INTO IP_METADATA_PERMISSION
			(ZDQXZJ,SJBSJQXBH,ZDBM,SFKYXG,SFKYXS) 
			VALUES
			(#{zdqxzj},#{sjbsjqxbh,jdbcType=VARCHAR},
			#{zdbm},#{sfkyxg,jdbcType=VARCHAR},#{sfkyxs,jdbcType=VARCHAR})
		</insert>
		<update id = "updateMetaDataPer" parameterType="com.cib.cap4j.cfn.dataManage.vo.IpMetadataPermissionVO">
			UPDATE IP_METADATA_PERMISSION
			<set>
   				ZDBM = #{zdbm}, SFKYXG = #{sfkyxg,jdbcType=VARCHAR}, SFKYXS = #{sfkyxs,jdbcType=VARCHAR}
 					WHERE ZDQXZJ = #{zdqxzj} and SJBSJQXBH = #{sjbsjqxbh}
 			</set>		
		</update>
		
		<delete id = "delMetaDataPer" parameterType="com.cib.cap4j.cfn.dataManage.vo.IpMetadataPermissionVO">
			DELETE FROM IP_METADATA_PERMISSION WHERE 1=1
			<if test="zdqxzj != null">AND ZDQXZJ=#{zdqxzj}</if>
			<if test="sjbsjqxbh != null">  AND sjbsjqxbh = #{sjbsjqxbh}</if>
		</delete>
		    
		<select id="findAssignedDataPermission" resultMap="ipMetadataPermission_result" parameterType="java.util.HashMap">
			SELECT D.LBMC, D.SSYM, M.ZDBM, M.SFKYXG
  				FROM IP_DATA_PERMISSION D, IP_METADATA_PERMISSION M
 					WHERE D.SJBSJQXZJ = M.SJBSJQXBH AND D.SJBSJQXZJ IN 
				( SELECT SQZYBM FROM IP_ARCGRANT ARC WHERE JLZT = '1' AND SQZYLX = #{sqzylx} AND SQDXBH IN
					(SELECT R.JSBH FROM IP_ROLE R, IP_ROLE_STAFF RS WHERE (R.JSBH = RS.JSBH AND RS.YHBH = #{yhbh} AND R.JSZT='1') OR R.JSBH='R99999998'))
		</select>
		
		<select id="findAssignedDataPermissionByRole" resultMap="ipMetadataPermission_result" parameterType="java.util.HashMap">
			SELECT D.LBMC, D.SSYM, M.ZDBM, M.SFKYXG
          		FROM IP_DATA_PERMISSION D, IP_METADATA_PERMISSION M
           			WHERE D.SJBSJQXZJ = M.SJBSJQXBH AND D.SJBSJQXZJ IN 
        			( SELECT SQZYBM FROM IP_ARCGRANT ARC WHERE JLZT = '1' AND SQZYLX = #{sqzylx} AND SQDXBH IN
          				(SELECT R.JSBH FROM IP_ROLE R WHERE (R.JSBH =  #{role} AND R.JSZT='1') OR R.JSBH='R99999998'))
		</select>
</mapper>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cib.cap4j.cfn.ci.dao.IIPRoleCIDao">
	<resultMap id="ipRoleCi_result" type="com.cib.cap4j.cfn.ci.vo.IPRoleCIVO">
	     <id column="ZJ" property="zj" />
	     <result column="JSBH" property="jsbh" />
	     <result column="JSMC" property="jsmc" />
	     <result column="JSLX" property="jslx" />
	     <result column="JSZT" property="jszt" />
	     <result column="JSMS" property="jsms" />
	     <result column="CJR" property="cjr" />
	     <result column="CJSJ" property="cjsj" />
	     <result column="ZHXGR" property="zhxgr" />
	     <result column="ZHXGSJ" property="zhxgsj" />
	     <result column="JLZT" property="jlzt" />
	     <result column="CZR" property="czr" />
	     <result column="CZSJ" property="czsj" />
	     <result column="CZLX" property="czlx" />
	     <result column="JSQZ" property="jsqz" />
	     <result column="KZZD1" property="kzzd1" />
	     <result column="KZZD2" property="kzzd2" />
	     <result column="KZZD3" property="kzzd3" />
	     <result column="KZZD4" property="kzzd4" />
	     <result column="KZZD5" property="kzzd5" />
	     <result column="KZZD6" property="kzzd6" />
	</resultMap>
		
    <!-- 查找所有的角色操作流水 -->
    <select id="findAll" resultMap="ipRoleCi_result" parameterType="com.cib.cap4j.cfn.ci.vo.IPRoleCIVO">
    	SELECT R.*, S.YHMC AS CZRXM, F.YHMC AS FHRXM
    	FROM  
    	IP_STAFF S RIGHT JOIN IP_ROLE_CI R ON R.CZR = S.YHBH 
    	LEFT JOIN IP_STAFF F ON F.YHBH = R.FHRY 
    	WHERE '1' = '1' 
    	<if test="jsmc != null and jsmc!=''">  AND R.JSMC like ${jsmc}</if>
    	<if test="czrxm != null and czrxm !=''">  AND S.YHMC like ${czrxm}</if>
    	<if test="czlx != null and czlx!=''">  AND R.CZLX = #{czlx}</if>
       	<if test="kzzd1 != null and kzzd1 != ''">  AND S.KZZD1 LIKE ${kzzd1}</if>
       	<if test="kzzd2 != null and kzzd2 != ''">  AND S.KZZD2 LIKE ${kzzd2}</if>
       	<if test="kzzd3 != null and kzzd3 != ''">  AND S.KZZD3 LIKE ${kzzd3}</if>
       	<if test="kzzd4 != null and kzzd4 != ''">  AND S.KZZD4 LIKE ${kzzd4}</if>
       	<if test="kzzd5 != null and kzzd5 != ''">  AND S.KZZD5 LIKE ${kzzd5}</if>
       	<if test="kzzd6 != null and kzzd6 != ''">  AND S.KZZD6 LIKE ${kzzd6}</if>
    	ORDER BY CZSJ DESC
    </select>
     <!-- 统计所有的角色操作流水 -->
    <select id="countAll" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(*) FROM IP_ROLE_CI R, IP_STAFF S WHERE R.CZR = S.YHBH 
    	<if test="jsmc != null and jsmc!=''">  AND R.JSMC like ${jsmc}</if>
    	<if test="czrxm != null and czrxm !=''">  AND S.YHMC like ${czrxm}</if>
    	<if test="czlx != null and czlx!=''">  AND R.CZLX = #{czlx}</if>
       	<if test="kzzd1 != null and kzzd1 != ''">  AND S.KZZD1 LIKE ${kzzd1}</if>
       	<if test="kzzd2 != null and kzzd2 != ''">  AND S.KZZD2 LIKE ${kzzd2}</if>
       	<if test="kzzd3 != null and kzzd3 != ''">  AND S.KZZD3 LIKE ${kzzd3}</if>
       	<if test="kzzd4 != null and kzzd4 != ''">  AND S.KZZD4 LIKE ${kzzd4}</if>
       	<if test="kzzd5 != null and kzzd5 != ''">  AND S.KZZD5 LIKE ${kzzd5}</if>
       	<if test="kzzd6 != null and kzzd6 != ''">  AND S.KZZD6 LIKE ${kzzd6}</if>
    </select>
    
        <!-- 查找所有的角色操作流水(权重小于自己) -->
    <select id="findAllWithRankGrant" resultMap="ipRoleCi_result" parameterType="com.cib.cap4j.cfn.ci.vo.IPRoleCIVO">
    	SELECT R.*, S.YHMC AS CZRXM FROM IP_ROLE_CI R, IP_STAFF S WHERE R.CZR = S.YHBH 
    	AND R.JSQZ <![CDATA[ <=]]> #{maxJsqz}
    	AND JSBH NOT IN
    	(
	    	SELECT JSBH FROM IP_ROLE WHERE JSLX='3'
	    	AND JSQZ = #{maxJsqz}
    	)
    	<if test="jsmc != null and jsmc!=''">  AND R.JSMC like ${jsmc}</if>
    	<if test="czrxm != null and czrxm !=''">  AND S.YHMC like ${czrxm}</if>
    	<if test="czlx != null and czlx!=''">  AND R.CZLX = #{czlx}</if>
    	ORDER BY CZSJ DESC
    </select>
     <!-- 统计所有的角色操作流水 (权重小于自己)-->
    <select id="countAllWithRankGrant" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(*) FROM IP_ROLE_CI R, IP_STAFF S WHERE R.CZR = S.YHBH 
    	    	AND R.JSQZ <![CDATA[ <=]]> #{maxJsqz}
    	AND JSBH NOT IN
    	(
	    	SELECT JSBH FROM IP_ROLE WHERE JSLX='3'
	    	AND JSQZ = #{maxJsqz}
    	)
    	<if test="jsmc != null and jsmc!=''">  AND R.JSMC like ${jsmc}</if>
    	<if test="czrxm != null and czrxm !=''">  AND S.YHMC like ${czrxm}</if>
    	<if test="czlx != null and czlx!=''">  AND R.CZLX = #{czlx}</if>
    </select>
  
      <update id="updateFhzt" parameterType="com.cib.cap4j.cfn.ci.vo.IPRoleCIVO">
    	UPDATE IP_ROLE_CI
     	<set>
     		FHZT = #{fhzt},
     		FHRY = #{fhry},
     	    FHSJ = #{fhsj}
     	</set>
     	WHERE ZJ = #{zj}
    </update>
    
     <select id="countUnverified" resultType="int" parameterType="java.lang.String">
     	SELECT COUNT(*) FROM IP_ROLE_CI WHERE JSBH = #{_parameter} AND FHZT = '0'
     </select>
     
     <select id="findNotFHCount" resultType="int" parameterType="java.lang.String">
     	SELECT COUNT(*) FROM IP_ROLE_CI WHERE FHZT = #{FHZT}
     </select>
      
     <select id="hasRecordByAction" resultType="int" parameterType="java.util.Map">
     	SELECT COUNT(*) FROM IP_ROLE_CI WHERE FHZT = #{FHZT} AND JSBH = #{JSBH} AND CZLX = #{CZLX}
     </select>
</mapper>		
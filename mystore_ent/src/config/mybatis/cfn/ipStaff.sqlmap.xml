<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cib.cap4j.cfn.staff.dao.IIPStaffDao">
	<resultMap id="ipStaff_result" type="com.cib.cap4j.cfn.staff.vo.IPStaffVO">
	     <id column="YHBH" property="yhbh" />
	     <result column="YHMC" property="yhmc" />
	     <result column="SSJG" property="ssjg" />
	     <result column="SSZZDY" property="sszzdy" />
	     <result column="YHLX" property="yhlx" />
	     <result column="ZT" property="zt" />
	     <result column="SFZH" property="sfzh" />
	     <result column="SR" property="sr" />
	     <result column="XB" property="xb" />
	     <result column="DHHM" property="dhhm" />
	     <result column="YJ" property="yj" />
	     <result column="DZ" property="dz" />
	     <result column="SDSJ" property="sdsj" />
	     <result column="YHDLM" property="yhdlm" />
	     <result column="NOTESID" property="notesid" />
	     <result column="CJR" property="cjr" />
	     <result column="CJSJ" property="cjsj" />
	     <result column="ZHXGR" property="zhxgr" />
	     <result column="ZHXGSJ" property="zhxgsj" />
	     <result column="JLZT" property="jlzt" />
	     <result column="KZZD1" property="kzzd1" />
	     <result column="KZZD2" property="kzzd2" />
	     <result column="KZZD3" property="kzzd3" />
	     <result column="KZZD4" property="kzzd4" />
	     <result column="KZZD5" property="kzzd5" />
	     <result column="KZZD6" property="kzzd6" />
	     <result column="KZZD7" property="kzzd7" />
	     <result column="KZZD8" property="kzzd8" />
	     <result column="KZZD9" property="kzzd9" />
	     <result column="KZZD10" property="kzzd10" />
	</resultMap>
		
	 <select id="findAllStaffs" resultMap="ipStaff_result" parameterType="java.util.Map">
    	SELECT S.*, U.JGMC AS SSJGMC FROM IP_STAFF S, IP_UNIT U WHERE S.SSJG = U.ZJ AND S.JLZT='1' 
    	<if test="pcjg != null and pcjg !=''">  AND S.SSJG <![CDATA[<>]]> #{pcjg}</if>
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID LIKE ${notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     	<if test="bhzjg == 0 and ssjg != null">  AND S.SSJG = #{ssjg}</if>
     	<if test="bhzjg == 1 and ssjg != null">  AND S.SSJG IN (SELECT ZJ FROM IP_UNIT WHERE XZCXLJ LIKE ${ssjg})</if>
     	<if test="yhlx != null and yhlx !=''">  AND S.YHLX = #{yhlx}</if>
     	<if test="zt != null and zt !=''">  AND S.ZT = #{zt}</if>
       	<if test="userUnit != null and userUnit == '999999999'">  AND U.ZJ = #{userUnit}</if>
       	<if test="userUnit != null and userUnit != '999999999'">  AND (U.XZCXLJ LIKE ${userUnit} OR U.ZJ = #{defaultUnit})</if>
       	<if test="kzzd1 != null and kzzd1 != ''">  AND S.KZZD1 LIKE ${kzzd1}</if>
       	<if test="kzzd2 != null and kzzd2 != ''">  AND S.KZZD2 LIKE ${kzzd2}</if>
       	<if test="kzzd3 != null and kzzd3 != ''">  AND S.KZZD3 LIKE ${kzzd3}</if>
       	<if test="kzzd4 != null and kzzd4 != ''">  AND S.KZZD4 LIKE ${kzzd4}</if>
       	<if test="kzzd5 != null and kzzd5 != ''">  AND S.KZZD5 LIKE ${kzzd5}</if>
       	<if test="kzzd6 != null and kzzd6 != ''">  AND S.KZZD6 LIKE ${kzzd6}</if>
       	<if test="kzzd7 != null and kzzd7 != ''">  AND S.KZZD7 LIKE ${kzzd7}</if>
       	<if test="kzzd8 != null and kzzd8 != ''">  AND S.KZZD8 LIKE ${kzzd8}</if>
       	<if test="kzzd9 != null and kzzd9 != ''">  AND S.KZZD9 LIKE ${kzzd9}</if>
       	<if test="kzzd10 != null and kzzd10 != ''">  AND S.KZZD10 LIKE ${kzzd10}</if>
       	ORDER BY S.CJSJ DESC
    </select>
 		
	 <select id="countAllStaffs" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(*) FROM IP_STAFF S, IP_UNIT U WHERE S.SSJG = U.ZJ AND S.JLZT='1' 
    	<if test="pcjg != null and pcjg !=''">  AND S.SSJG <![CDATA[<>]]> #{pcjg}</if>
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID LIKE ${notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     	<if test="bhzjg == 0 and ssjg != null">  AND S.SSJG = #{ssjg}</if>
     	<if test="bhzjg == 1 and ssjg != null">  AND S.SSJG IN (SELECT ZJ FROM IP_UNIT WHERE XZCXLJ LIKE ${ssjg}) </if>
     	<if test="yhlx != null and yhlx !=''">  AND S.YHLX = #{yhlx}</if>
     	<if test="zt != null and zt !=''">  AND S.ZT = #{zt}</if>
       	<if test="userUnit != null and userUnit == '999999999'">  AND U.ZJ = #{userUnit}</if>
       	<if test="userUnit != null and userUnit != '999999999'">  AND (U.XZCXLJ LIKE ${userUnit} OR U.ZJ = #{defaultUnit})</if>
   		<if test="kzzd1 != null and kzzd1 != ''">  AND S.KZZD1 LIKE ${kzzd1}</if>
       	<if test="kzzd2 != null and kzzd2 != ''">  AND S.KZZD2 LIKE ${kzzd2}</if>
       	<if test="kzzd3 != null and kzzd3 != ''">  AND S.KZZD3 LIKE ${kzzd3}</if>
       	<if test="kzzd4 != null and kzzd4 != ''">  AND S.KZZD4 LIKE ${kzzd4}</if>
       	<if test="kzzd5 != null and kzzd5 != ''">  AND S.KZZD5 LIKE ${kzzd5}</if>
       	<if test="kzzd6 != null and kzzd6 != ''">  AND S.KZZD6 LIKE ${kzzd6}</if>
       	<if test="kzzd7 != null and kzzd7 != ''">  AND S.KZZD7 LIKE ${kzzd7}</if>
       	<if test="kzzd8 != null and kzzd8 != ''">  AND S.KZZD8 LIKE ${kzzd8}</if>
       	<if test="kzzd9 != null and kzzd9 != ''">  AND S.KZZD9 LIKE ${kzzd9}</if>
       	<if test="kzzd10 != null and kzzd10 != ''">  AND S.KZZD10 LIKE ${kzzd10}</if>
     </select>
    
    <!-- 查找未分配给角色的用户 -->
    <select id="findNotAddedStaff" resultMap="ipStaff_result" parameterType="java.util.Map">
    	SELECT S.*, U.JGMC AS SSJGMC FROM IP_STAFF S, IP_UNIT U WHERE S.SSJG = U.ZJ AND S.JLZT='1'
    	 AND S.YHBH NOT IN (SELECT RS.YHBH FROM IP_ROLE_STAFF RS WHERE RS.JLZT='1' AND RS.JSBH=#{jsbh})
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID LIKE ${notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     	<if test="bhzjg == 0 and ssjg != null">  AND S.SSJG = #{ssjg}</if>
     	<if test="bhzjg == 1 and ssjg != null">  AND S.SSJG IN (SELECT ZJ FROM IP_UNIT WHERE XZCXLJ LIKE ${ssjg}) </if>
       	<if test="userUnit != null and userUnit == '999999999'">  AND U.ZJ = #{userUnit}</if>
       	<if test="userUnit != null and userUnit != '999999999'">  AND (U.XZCXLJ LIKE ${userUnit} OR U.ZJ = #{defaultUnit})</if>
       	ORDER BY S.CJSJ DESC
    </select>
     <!-- 统计未分配给角色的用户 -->
    <select id="countNotAddedStaff" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(*) FROM IP_STAFF S, IP_UNIT U WHERE S.SSJG = U.ZJ AND S.JLZT='1'
    	 AND S.YHBH NOT IN (SELECT RS.YHBH FROM IP_ROLE_STAFF RS WHERE RS.JLZT='1' AND RS.JSBH=#{jsbh})
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID LIKE ${notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     	<if test="bhzjg == 0 and ssjg != null">  AND S.SSJG = #{ssjg}</if>
     	<if test="bhzjg == 1 and ssjg != null">  AND S.SSJG IN (SELECT ZJ FROM IP_UNIT WHERE XZCXLJ LIKE ${ssjg}) </if>
     	<if test="userUnit != null and userUnit == '999999999'">  AND U.ZJ = #{userUnit}</if>
       	<if test="userUnit != null and userUnit != '999999999'">  AND (U.XZCXLJ LIKE ${userUnit} OR U.ZJ = #{defaultUnit})</if>
    </select>
    
    <!-- 查找分配给角色的用户 -->
    <select id="findStaffByYhbh" resultMap="ipStaff_result" parameterType="java.util.Map">
    	SELECT S.*, U.JGMC AS SSJGMC FROM IP_STAFF S, IP_UNIT U WHERE S.SSJG = U.ZJ AND S.JLZT='1'
    	 AND S.YHBH IN (SELECT RS.YHBH FROM IP_ROLE_STAFF RS WHERE RS.JLZT='1' AND RS.JSBH=#{jsbh})
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID LIKE ${notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     	<if test="bhzjg == 0 and ssjg != null">  AND S.SSJG = #{ssjg}</if>
     	<if test="bhzjg == 1 and ssjg != null">  AND S.SSJG IN (SELECT ZJ FROM IP_UNIT WHERE XZCXLJ LIKE ${ssjg}) </if>
     	<if test="userUnit != null and userUnit == '999999999'">  AND U.ZJ = #{userUnit}</if>
       	<if test="userUnit != null and userUnit != '999999999'">  AND (U.XZCXLJ LIKE ${userUnit} OR U.ZJ = #{defaultUnit})</if>
       	ORDER BY S.CJSJ DESC
    </select>
    <!-- 统计分配给角色的用户 -->
    <select id="countStaffByYhbh" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(*) FROM IP_STAFF S, IP_UNIT U WHERE S.SSJG = U.ZJ AND S.JLZT='1'
    	 AND S.YHBH IN (SELECT RS.YHBH FROM IP_ROLE_STAFF RS WHERE RS.JLZT='1' AND RS.JSBH=#{jsbh})
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID LIKE ${notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     	<if test="bhzjg == 0 and ssjg != null">  AND S.SSJG = #{ssjg}</if>
     	<if test="bhzjg == 1 and ssjg != null">  AND S.SSJG IN (SELECT ZJ FROM IP_UNIT WHERE XZCXLJ LIKE ${ssjg}) </if>
     	<if test="userUnit != null and userUnit == '999999999'">  AND U.ZJ = #{userUnit}</if>
       	<if test="userUnit != null and userUnit != '999999999'">  AND (U.XZCXLJ LIKE ${userUnit} OR U.ZJ = #{defaultUnit})</if>
    </select>
    
    	
	 <select id="findStaffNoGroup" resultMap="ipStaff_result" parameterType="java.util.Map">
    	SELECT S.YHBH,S.YHMC,S.NOTESID FROM IP_STAFF S WHERE  S.JLZT='1' 
    	  AND S.YHBH not in
    	  (select distinct(D.YHBH) from IP_DSM_STAFF D WHERE D.JLZT='1' AND D.QXZJ = #{groupId})
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID =#{notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
       	ORDER BY S.CJSJ DESC
    </select>
 		
	 <select id="countStaffNoGroup" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(S.YHBH) FROM IP_STAFF S WHERE  S.JLZT='1' 
    	  AND S.YHBH not in
    	  (select distinct(D.YHBH) from IP_DSM_STAFF D WHERE D.JLZT='1' AND QXZJ = #{groupId})
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID = #{notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     </select>
     
     <select id="findStaffHasGroup" resultMap="ipStaff_result" parameterType="java.util.Map">
    	SELECT S.* FROM IP_STAFF S,IP_DSM_STAFF D WHERE S.JLZT='1' AND D.JLZT='1' 
    	AND S.YHBH = D.YHBH AND D.QXZJ = #{groupId} 
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID =#{notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
       	ORDER BY S.CJSJ DESC
    </select>
 		
	 <select id="countStaffHasGroup" resultType="int" parameterType="java.util.Map">
    	SELECT COUNT(*) FROM IP_STAFF S,IP_DSM_STAFF D WHERE S.JLZT='1' AND D.JLZT='1' 
    	AND S.YHBH = D.YHBH AND D.QXZJ = #{groupId}  
    	<if test="notesid != null and notesid !=''">  AND S.NOTESID = #{notesid}</if>
     	<if test="yhmc != null and yhmc !=''">  AND S.YHMC LIKE ${yhmc}</if>
     </select>
</mapper>		